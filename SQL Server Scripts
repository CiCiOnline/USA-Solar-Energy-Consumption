/* 
CREATING THE SOLAR_DATA TABLE - Made of columns from 3 seperate tables
*/


SELECT *
FROM [12 solar-energy-consumption]

SELECT *
FROM [installed-solar-PV-capacity]

SELECT *
FROM [Renewable-energy-consumption]



DROP VIEW IF EXISTS Sum_Solar_Data;

CREATE VIEW Sum_Solar_Data AS

SELECT 
econs.Entity,
econs.Code,
econs.Year,
insolar.Solar_Capacity,
solcons.Electricity_from_solar_TWh,
econs.Solar_Generation_TWh

FROM [Renewable-energy-consumption] AS econs
JOIN [12 solar-energy-consumption] AS solcons
ON econs.Entity = solcons.Entity
AND econs.Code = solcons.Code
AND econs.Year = solcons.Year

JOIN [installed-solar-PV-capacity] AS insolar
ON econs.Entity = insolar.Entity
AND econs.Code = insolar.Code
AND econs.Year = insolar.Year;


SELECT COUNT (*)
FROM Sum_Solar_Data






/*
DATA MERGING, CLEANING AND SEGMENTATION:
- Data joined from Table- Renewable Energy Consumption as econs, with Renewable Energy Production as eprod, and Columns renamed in 
- 
*/

SELECT *
FROM [renewable-energy-consumption] AS econs
JOIN [modern-renewable-prod] AS eprod
ON econs.Entity = eprod.Entity
AND econs.Code = eprod.Code
AND econs.Year = eprod.Year



CREATE VIEW Energy_Prod_and_Cons_View AS
SELECT 
    econs.Entity,
    econs.Code,
    econs.Year,
	eprod.Electricity_from_wind_TWh,
	econs.Wind_Generation_TWh AS Wind_Energy_Consumption,
	eprod.Electricity_from_solar_TWh,
	econs.Solar_Generation_TWh AS Solar_Energy_Consumption,
	eprod.Electricity_from_hydro_TWh,
	econs.Hydro_Generation_TWh AS Hydro_Energy_Consumption,
	eprod.Other_renewables_including_bioenergy_TWh,
	econs.Geo_Biomass_Other_TWh AS Biomass_Other_Energy_Consumption
FROM 
    [renewable-energy-consumption] AS econs
JOIN 
    [modern-renewable-prod] AS eprod
ON 
    econs.Entity = eprod.Entity
AND 
    econs.Code = eprod.Code
AND 
    econs.Year = eprod.Year;



/* DELETES VIEW EARLIER CREATED */

DROP VIEW IF EXISTS Energy_Prod_and_Cons_View;



*/ Create the view again with rounded values that changes multiple decimal place numbers to 3 decimal places instead */

 CREATE VIEW Energy_Prod_and_Con_View AS 
SELECT 
    econs.Entity,
    econs.Code,
    econs.Year,
    ROUND(eprod.Electricity_from_wind_TWh, 3) AS Wind_Energy_Production,
    ROUND(econs.Wind_Generation_TWh, 3) AS Wind_Energy_Consumption,
    ROUND(eprod.Electricity_from_solar_TWh, 3) AS Solar_Energy_Production,
    ROUND(econs.Solar_Generation_TWh, 3) AS Solar_Energy_Consumption,
    ROUND(eprod.Electricity_from_hydro_TWh, 3) AS Hydro_Energy_Production,
    ROUND(econs.Hydro_Generation_TWh, 3) AS Hydro_Energy_Consumption,
    ROUND(eprod.Other_renewables_including_bioenergy_TWh, 3) AS Biomass_Other_Energy_Production,
    ROUND(econs.Geo_Biomass_Other_TWh, 3) AS Biomass_Other_Energy_Consumption
FROM 
    [renewable-energy-consumption] AS econs
JOIN 
    [modern-renewable-prod] AS eprod
ON 
    econs.Entity = eprod.Entity
AND 
    econs.Code = eprod.Code
AND 
    econs.Year = eprod.Year


